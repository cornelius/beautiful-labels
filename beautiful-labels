#!/usr/bin/env python3
"""Usage:
  beautiful-labels scan ORG REPO DIRECTORY
  beautiful-labels create-svg ORG REPO DIRECTORY [--label-font-size=<size>]
  beautiful-labels write-config ORG REPO DIRECTORY
  beautiful-labels save-backup ORG REPO DIRECTORY
  beautiful-labels -h | --help

Arguments:
  ORG        name of GitHub organization
  REPO       name of GitHub repository
  DIRECTORY  working directory where data is read and written to

Options:
  -h, --help                Show this help
  --label-font-size=<size>  Size of font on labels
"""
from docopt import docopt

import sys
import yaml
from pathlib import Path

from config import Config
from labels import Labels
import scanner
import terraform
import svg
import backup

arguments = docopt(__doc__)

org = arguments["ORG"]
repo = arguments["REPO"]
working_dir = arguments["DIRECTORY"]
label_font_size = arguments["--label-font-size"]
if label_font_size == None:
    label_font_size = 14

config = Config(working_dir, org, repo)
labels = Labels(org, repo)

cmd = sys.argv[1]
if cmd == "scan":
    labels = scanner.scan_labels(config)
    labels.save(config.yaml_filename())
elif cmd == "write-config":
    labels.load(config.yaml_filename())
    terraform.write_terraform_config(labels, config.terraform_filename())
elif cmd == "create-svg":
    labels.load(config.yaml_filename())
    svg.write_svg(labels, config.svg_filename(), label_font_size=label_font_size)
elif cmd == "save-backup":
    backup.save(org, repo, config)
else:
    print("Unknown command '%s'. Exiting." % cmd, file=sys.stderr)
    sys.exit(1)
